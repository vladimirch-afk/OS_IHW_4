# OS_IHW_4
# Чечуров Владимир Сергеевич, ОС ИДЗ-4, Вариант 21

Решение выполнялось по критериям на оценку 10

## Условие

Задача о нелюдимых садовниках. Имеется пустой участок земли (двумерный массив размером M ×N) и план сада, разбитого на отдельные квадраты. От 10 до 30 процентов (задается случайно) площади сада заняты прудами или камнями. То есть недоступны для ухаживания. Эти квадраты располагаются на плане произвольным (случайным) образом. Ухаживание за садом выполняют два садовника, которые не хотят встречаться друг другом (то есть, одновременно появляться в одном и том же квадрате). Первый садовник начинает работу с верхнего левого угла сада и перемещается слева направо, сделав ряд, он спускается вниз и идет в обратном направлении, пропуская обработанные участки. Второй садовник начинает работу с нижнего правого угла сада и перемещается снизу вверх, сделав ряд, он перемещается влево и также идет в обратную сторону. Если садовник видит, что участок сада уже обработан другим садовником или является необрабатываемым, он идет дальше. Если по пути какой-то участок занят другим садовником, то садовник ожидает когда участок освободится, чтобы пройти дальше на доступный ему необработанный участок. Садовники должны работать одновременно со скоростями, определяемыми как параметры задачи. Прохождение через любой квадрат занимает некоторое время, которое задается константой, меньшей чем времена обработки и принимается за единицу времени. Создать многопроцессное приложение, моделирующее работу садовников. Каждый садовник — это отдельный процесс.

## Решение

Сад - двумерный массив, где каждый участок - зона в 2 на 2 клетки. Все садовники - процессы. Каждому участку соответствует свой семафор, который меняет свое значение, когда в него заходит садовник.

При обработке поле, садовник записывает в ячейку массива свой номер.

Двумерный массив на момент создания, а потом и в процессе выполнения заполняется числами:

- 0 — если не обработано
- -1 — поле не может быть обработано и выводится как Х
- 1 — поле обработано первым садовником
- 2 — поле обработано вторым садовником

### Программа на 4-5 баллов
Примечание: Во всех программах используется UDP-протокол.

Аргументы для запуска сервера (`server.c`): 

```
<server IP> <server PORT> <grid side size>
```

Аргументы для запуска клиентов (`first.c`, `second.c`)

```
<server IP> <server PORT> <speed>
```

Сервер обслуживает один порт для клиентов-садовников. При запуске сервера создается поток для прослушивания этого порта. После запуска сервер ожидает подключения клиентов-садовников. При каждом новом подключении создается дочерний процесс для обработки соединения. Общение между клиентами и сервером происходит посредством структуры `Task`. Она содержит ID садовника, его местоположение, время работы и флаг завершенности работы. Если участок обрабатываемый, то происходит обработка участка и сообщение об этом на сервер.

#### Результат работы

![image-20240519171022872](/home/vlad/.config/Typora/typora-user-images/image-20240519171022872.png)

Сервер:

``` 
./server 127.0.0.1 8080 2
0 0 0 0 
0 0 0 0 
0 X 0 0 
0 X 0 0 
Client 127.0.0.1:42684
child process: 15917
Client 127.0.0.1:43196
child process: 15918

1 0 0 0 
0 0 0 0 
0 X 0 0 
0 X 0 2 


1 1 0 0 
0 0 0 0 
0 X 0 0 
0 X 0 2 


1 1 1 0 
0 0 0 0 
0 X 0 0 
0 X 0 2 


1 1 1 0 
0 0 0 0 
0 X 0 2 
0 X 0 2 


1 1 1 1 
0 0 0 0 
0 X 0 2 
0 X 0 2 


1 1 1 1 
0 0 0 1 
0 X 0 2 
0 X 0 2 


1 1 1 1 
0 0 0 1 
0 X 0 2 
0 X 0 2 


1 1 1 1 
0 0 1 1 
0 X 0 2 
0 X 0 2 


1 1 1 1 
0 1 1 1 
0 X 0 2 
0 X 0 2 


1 1 1 1 
1 1 1 1 
0 X 0 2 
0 X 0 2 


1 1 1 1 
1 1 1 1 
0 X 0 2 
0 X 0 2 


1 1 1 1 
1 1 1 1 
1 X 0 2 
0 X 0 2 


1 1 1 1 
1 1 1 1 
1 X 0 2 
0 X 0 2 


1 1 1 1 
1 1 1 1 
1 X 0 2 
0 X 0 2 


1 1 1 1 
1 1 1 1 
1 X 0 2 
0 X 0 2 


1 1 1 1 
1 1 1 1 
1 X 1 2 
0 X 0 2 


1 1 1 1 
1 1 1 1 
1 X 1 2 
0 X 0 2 


1 1 1 1 
1 1 1 1 
1 X 1 2 
0 X 0 2 


1 1 1 1 
1 1 1 1 
1 X 1 2 
0 X 0 2 


1 1 1 1 
1 1 1 1 
1 X 1 2 
0 X 1 2 


1 1 1 1 
1 1 1 1 
1 X 1 2 
0 X 1 2 


1 1 1 1 
1 1 1 1 
1 X 1 2 
1 X 1 2 


1 1 1 1 
1 1 1 1 
1 X 1 2 
1 X 1 2 


1 1 1 1 
1 1 1 1 
1 X 1 2 
1 X 1 2 


1 1 1 1 
1 1 1 1 
1 X 1 2 
1 X 1 2 


1 1 1 1 
1 1 1 1 
1 X 1 2 
1 X 1 2 


1 1 1 1 
1 1 1 1 
1 X 1 2 
1 X 1 2 


1 1 1 1 
1 1 1 1 
1 X 1 2 
1 X 1 2 


1 1 1 1 
1 1 1 1 
1 X 1 2 
1 X 1 2 


1 1 1 1 
1 1 1 1 
1 X 1 2 
1 X 1 2 


1 1 1 1 
1 1 1 1 
1 X 1 2 
1 X 1 2 


1 1 1 1 
1 1 1 1 
1 X 1 2 
1 X 1 2
```

Клиент (2 садовника в одной консоли, из-за невозможности запуска на одном компьютере одновременно в 2х разных консолях, иначе один садовник уже завершит работу к моменту запуска второго): 

```
Gardener 1 at row: 0, col: 0
Gardener 1 at row: 0, col: 1
Gardener 2 at row: 3, col: 3
Gardener 1 at row: 0, col: 2
Gardener 1 at row: 0, col: 3
Gardener 2 at row: 2, col: 3
Gardener 1 at row: 1, col: 3
Gardener 1 at row: 1, col: 2
Gardener 1 at row: 1, col: 1
Gardener 2 at row: 1, col: 3
Gardener 1 at row: 1, col: 0
Gardener 2 at row: 0, col: 3
Gardener 1 at row: 2, col: 0
Gardener 2 at row: 0, col: 2
Gardener 1 at row: 2, col: 1
Gardener 1 at row: 2, col: 2
Gardener 2 at row: 1, col: 2
Gardener 1 at row: 2, col: 3
Gardener 1 at row: 3, col: 3
Gardener 1 at row: 3, col: 2
Gardener 1 at row: 3, col: 1
Gardener 2 at row: 2, col: 2
Gardener 1 at row: 3, col: 0
Work is done (1sr gardener)
Gardener 2 at row: 3, col: 2
Gardener 2 at row: 3, col: 1
Gardener 2 at row: 2, col: 1
Gardener 2 at row: 1, col: 1
Gardener 2 at row: 0, col: 1
Gardener 2 at row: 0, col: 0
Gardener 2 at row: 1, col: 0
Gardener 2 at row: 2, col: 0
Gardener 2 at row: 3, col: 0
Work is done (2nd gardener)
```



### Программа на 6-10 баллов

Аргументы для запуска сервера (`server.c`): 

```
<server IP> <server port> <observer port> <grid side size>
```

Аргументы для запуска клиентов (`first.c`, `second.c`)

```
<server IP> <server PORT> <speed>
```

Аргументы для запуска наблюдателя (`server.c`): 

```
<server IP> <server port>
```

Сервер теперь обслуживает два порта: для клиентов-садовников и для наблюдателей. Когда сервер запускается, создается 2 разных потока, для прослушивания портов, один для подключения садовников,, а другой для подключения наблюдателей . При подключении наблюдатели добавляются в список подписчиков, которым будут рассылаться уведомления о состоянии сервера.  Также  сервер ожидает подключения клиентов-садовников. При подключении садовника создается дочерний процесс, который обрабатывает данное подключение. Общение между клиентами и сервером происходит посредством структуры `Task`. Она содержит ID садовника, его местоположение, время работы и флаг завершенности работы. В этой программе, в отличие от предыдущей, реализовано подключение нескольких наблюдателей, которые отображают происходящие на сервере события, возможно подключение сразу нескольких клиентов, возможно отключение и подключение клиентов и наблюдателей в процессе работы сервера, происходит завершение работы клиентов и наблюдателей при завершении работы сервера.

#### Результат работы

![image-20240519173023455](/home/vlad/.config/Typora/typora-user-images/image-20240519173023455.png)

Сервер:

```
0 0 0 0 
0 0 0 0 
0 X 0 0 
0 X 0 0 

Connected client 127.0.0.1:45207

Observer connected

Connected client 127.0.0.1:3276

child process: 16484
child process: 16485
Connected client 127.0.0.1:4812


1 0 0 0 
0 0 0 0 
0 X 0 0 
0 X 0 2 


1 1 0 0 
0 0 0 0 
0 X 0 0 
0 X 0 2 


1 1 0 0 
0 0 0 0 
0 X 0 2 
0 X 0 2 


1 1 1 0 
0 0 0 0 
0 X 0 2 
0 X 0 2 


1 1 1 1 
0 0 0 0 
0 X 0 2 
0 X 0 2 


1 1 1 1 
0 0 0 0 
0 X 0 2 
0 X 0 2 


1 1 1 1 
0 0 0 2 
0 X 0 2 
0 X 0 2 


1 1 1 1 
0 0 0 2 
0 X 0 2 
0 X 0 2 


1 1 1 1 
0 0 0 2 
0 X 0 2 
0 X 0 2 


1 1 1 1 
0 0 2 2 
0 X 0 2 
0 X 0 2 


1 1 1 1 
0 0 2 2 
0 X 2 2 
0 X 0 2 


1 1 1 1 
0 0 2 2 
0 X 2 2 
0 X 0 2 


1 1 1 1 
0 1 2 2 
0 X 2 2 
0 X 0 2 


1 1 1 1 
1 1 2 2 
0 X 2 2 
0 X 0 2 


1 1 1 1 
1 1 2 2 
0 X 2 2 
0 X 2 2 


1 1 1 1 
1 1 2 2 
1 X 2 2 
0 X 2 2 


1 1 1 1 
1 1 2 2 
1 X 2 2 
0 X 2 2 


1 1 1 1 
1 1 2 2 
1 X 2 2 
0 X 2 2 


1 1 1 1 
1 1 2 2 
1 X 2 2 
0 X 2 2 


1 1 1 1 
1 1 2 2 
1 X 2 2 
0 X 2 2 


1 1 1 1 
1 1 2 2 
1 X 2 2 
0 X 2 2 


1 1 1 1 
1 1 2 2 
1 X 2 2 
0 X 2 2 


1 1 1 1 
1 1 2 2 
1 X 2 2 
0 X 2 2 


1 1 1 1 
1 1 2 2 
1 X 2 2 
0 X 2 2 


1 1 1 1 
1 1 2 2 
1 X 2 2 
0 X 2 2 


1 1 1 1 
1 1 2 2 
1 X 2 2 
0 X 2 2 


1 1 1 1 
1 1 2 2 
1 X 2 2 
1 X 2 2 


1 1 1 1 
1 1 2 2 
1 X 2 2 
1 X 2 2 


1 1 1 1 
1 1 2 2 
1 X 2 2 
1 X 2 2 


1 1 1 1 
1 1 2 2 
1 X 2 2 
1 X 2 2 


1 1 1 1 
1 1 2 2 
1 X 2 2 
1 X 2 2 


1 1 1 1 
1 1 2 2 
1 X 2 2 
1 X 2 2 
^CServer stopped
```

Наблюдатель:

```
Connected client 127.0.0.1:45207

Observer connected

Connected client 127.0.0.1:3276

Connected client 127.0.0.1:4812

Gardener 2 at row: 3, col: 3

Gardener 1 at row: 0, col: 0


1 0 0 0 
0 0 0 0 
0 X 0 0 
0 X 0 2 

Gardener 1 at row: 0, col: 1


1 1 0 0 
0 0 0 0 
0 X 0 0 
0 X 0 2 

Gardener 2 at row: 2, col: 3


1 1 0 0 
0 0 0 0 
0 X 0 2 
0 X 0 2 

Gardener 1 at row: 0, col: 2


1 1 1 0 
0 0 0 0 
0 X 0 2 
0 X 0 2 

Gardener 1 at row: 0, col: 3


1 1 1 1 
0 0 0 0 
0 X 0 2 
0 X 0 2 


1 1 1 1 
0 0 0 0 
0 X 0 2 
0 X 0 2 

Gardener 2 at row: 1, col: 3


1 1 1 1 
0 0 0 2 
0 X 0 2 
0 X 0 2 

Gardener 2 at row: 0, col: 3


1 1 1 1 
0 0 0 2 
0 X 0 2 
0 X 0 2 

Gardener 2 at row: 0, col: 2


1 1 1 1 
0 0 0 2 
0 X 0 2 
0 X 0 2 

Gardener 2 at row: 1, col: 2


1 1 1 1 
0 0 2 2 
0 X 0 2 
0 X 0 2 

Gardener 2 at row: 2, col: 2

Gardener 1 at row: 1, col: 3


1 1 1 1 
0 0 2 2 
0 X 2 2 
0 X 0 2 

Gardener 1 at row: 1, col: 2


1 1 1 1 
0 0 2 2 
0 X 2 2 
0 X 0 2 

Gardener 1 at row: 1, col: 1


1 1 1 1 
0 1 2 2 
0 X 2 2 
0 X 0 2 

Gardener 1 at row: 1, col: 0


1 1 1 1 
1 1 2 2 
0 X 2 2 
0 X 0 2 

Gardener 2 at row: 3, col: 2


1 1 1 1 
1 1 2 2 
0 X 2 2 
0 X 2 2 

Gardener 1 at row: 2, col: 0


1 1 1 1 
1 1 2 2 
1 X 2 2 
0 X 2 2 

Gardener 1 at row: 2, col: 1


1 1 1 1 
1 1 2 2 
1 X 2 2 
0 X 2 2 


1 1 1 1 
1 1 2 2 
1 X 2 2 
0 X 2 2 

Gardener 2 at row: 3, col: 1

Gardener 1 at row: 2, col: 2


1 1 1 1 
1 1 2 2 
1 X 2 2 
0 X 2 2 

Gardener 1 at row: 2, col: 3


1 1 1 1 
1 1 2 2 
1 X 2 2 
0 X 2 2 

Gardener 1 at row: 3, col: 3


1 1 1 1 
1 1 2 2 
1 X 2 2 
0 X 2 2 

Gardener 1 at row: 3, col: 2


1 1 1 1 
1 1 2 2 
1 X 2 2 
0 X 2 2 


1 1 1 1 
1 1 2 2 
1 X 2 2 
0 X 2 2 

Gardener 2 at row: 2, col: 1


1 1 1 1 
1 1 2 2 
1 X 2 2 
0 X 2 2 

Gardener 2 at row: 1, col: 1

Gardener 1 at row: 3, col: 1


1 1 1 1 
1 1 2 2 
1 X 2 2 
0 X 2 2 


1 1 1 1 
1 1 2 2 
1 X 2 2 
0 X 2 2 

Gardener 2 at row: 0, col: 1

Gardener 1 at row: 3, col: 0


1 1 1 1 
1 1 2 2 
1 X 2 2 
1 X 2 2 

Gardener 2 at row: 0, col: 0


1 1 1 1 
1 1 2 2 
1 X 2 2 
1 X 2 2 

Gardener 1 finished his work


1 1 1 1 
1 1 2 2 
1 X 2 2 
1 X 2 2 

Gardener 2 at row: 1, col: 0


1 1 1 1 
1 1 2 2 
1 X 2 2 
1 X 2 2 

Gardener 2 at row: 2, col: 0


1 1 1 1 
1 1 2 2 
1 X 2 2 
1 X 2 2 

Gardener 2 at row: 3, col: 0


1 1 1 1 
1 1 2 2 
1 X 2 2 
1 X 2 2 

Gardener 2 finished his work

Server connection closed
```

Клиент (2 садовника в одной консоли, из-за невозможности запуска на одном компьютере одновременно в 2х разных консолях, иначе один садовник уже завершит работу к моменту запуска второго): 

```
Gardener 1 at row: 0, col: 0
Gardener 2 at row: 3, col: 3
Gardener 1 at row: 0, col: 1
Gardener 1 at row: 0, col: 2
Gardener 2 at row: 2, col: 3
Gardener 1 at row: 0, col: 3
Gardener 2 at row: 1, col: 3
Gardener 2 at row: 0, col: 3
Gardener 2 at row: 0, col: 2
Gardener 2 at row: 1, col: 2
Gardener 1 at row: 1, col: 3
Gardener 1 at row: 1, col: 2
Gardener 1 at row: 1, col: 1
Gardener 2 at row: 2, col: 2
Gardener 1 at row: 1, col: 0
Gardener 1 at row: 2, col: 0
Gardener 1 at row: 2, col: 1
Gardener 2 at row: 3, col: 2
Gardener 1 at row: 2, col: 2
Gardener 1 at row: 2, col: 3
Gardener 1 at row: 3, col: 3
Gardener 1 at row: 3, col: 2
Gardener 2 at row: 3, col: 1
Gardener 2 at row: 2, col: 1
Gardener 2 at row: 1, col: 1
Gardener 1 at row: 3, col: 1
Gardener 2 at row: 0, col: 1
Gardener 1 at row: 3, col: 0
Work is done (1sr gardener)
Gardener 2 at row: 0, col: 0
Gardener 2 at row: 1, col: 0
Gardener 2 at row: 2, col: 0
Gardener 2 at row: 3, col: 0
Work is done (2nd gardener)
Server connection closed
```



